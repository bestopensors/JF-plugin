<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Poster Tags</title>
</head>
<body>
    <div id="PosterTagsConfigPage" class="configPage">
        <div class="sectionTitleContainer flex align-items-center">
            <h2 class="sectionTitle">Poster Tags â€” Settings</h2>
        </div>
        <div class="sectionContentContainer sectionContentContainerBorderNoPadding">
            <form id="PosterTagsConfigForm">
                <p class="fieldDescription" style="margin-bottom: 1.5em;">
                    Configure how tags are embedded on library posters. With <strong>Apply automatically after library scan</strong> enabled, new movies and series get tags without running a task. You can also run the <strong>Add Poster Tags</strong> scheduled task (Dashboard â†’ Scheduled Tasks) to apply to existing items.
                </p>

                <h3 class="sectionTitle" style="font-size: 1em; margin: 1em 0 0.5em;">Libraries</h3>
                <div class="selectContainer">
                    <label class="inputLabel inputLabelUnified" for="LibraryIds">Libraries to process</label>
                    <select id="LibraryIds" name="LibraryIds" class="select flex align-items-center" multiple size="4"></select>
                    <div class="fieldDescription">Leave empty to process all libraries.</div>
                </div>

                <h3 class="sectionTitle" style="font-size: 1em; margin: 1.5em 0 0.5em;">Live preview</h3>
                <p class="fieldDescription">Preview uses a random movie or series from your selected libraries (only items with a primary poster image). Same logic as applied tags (resolution, HDR, audio, ratings â€” including external API if enabled).</p>
                <div id="PreviewContainer" style="margin: 1em 0; padding: 1em; background: rgba(0,0,0,0.2); border-radius: 4px;">
                    <div id="PreviewLabel" style="margin-bottom: 0.5em; font-weight: 500;">Using: â€”</div>
                    <div id="PreviewImageWrap" style="position: relative; display: inline-block; min-height: 200px;">
                        <div id="PreviewSpinner" class="posterTagsSpinner" style="display: none; position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%); width: 48px; height: 48px; border: 4px solid rgba(255,255,255,0.3); border-top-color: #fff; border-radius: 50%; animation: posterTagsSpin 0.8s linear infinite;"></div>
                        <img id="PreviewImage" alt="Preview" style="max-width: 300px; max-height: 450px; display: block; border-radius: 4px; min-height: 200px; background: rgba(0,0,0,0.3);" />
                    </div>
                    <div style="margin-top: 0.5em;">
                        <button type="button" id="RefreshPreviewBtn" class="btn btn-secondary">Pick random &amp; refresh preview</button>
                        <span id="PreviewStatus" style="margin-left: 0.5em; font-size: 0.9em;"></span>
                    </div>
                </div>
                <style>
                    @keyframes posterTagsSpin { to { transform: translate(-50%,-50%) rotate(360deg); } }
                    .posterTagsSpinner.isLoading { display: block !important; }
                </style>

                <h3 class="sectionTitle" style="font-size: 1em; margin: 1.5em 0 0.5em;">Badge position &amp; shape</h3>
                <div class="selectContainer">
                    <label class="inputLabel inputLabelUnified" for="BadgePosition">Position on poster</label>
                    <select id="BadgePosition" name="BadgePosition" class="select flex align-items-center">
                        <option value="TopLeft">Top Left</option>
                        <option value="TopCenter">Top Center</option>
                        <option value="TopRight">Top Right</option>
                        <option value="BottomLeft">Bottom Left</option>
                        <option value="BottomCenter">Bottom Center</option>
                        <option value="BottomRight">Bottom Right</option>
                    </select>
                </div>
                <div class="inputContainer" style="margin-top: 0.5em;">
                    <label class="inputLabel inputLabelUnified" for="TagCurvature">Tag edge curvature</label>
                    <input type="range" id="TagCurvature" name="TagCurvature" min="0" max="100" value="0" style="width: 12em; vertical-align: middle;" />
                    <span id="TagCurvatureLabel" style="margin-left: 0.5em;">0 â€” Rectangle</span>
                    <div class="fieldDescription">0 = sharp rectangle, 100 = pill. Applies to main badges and custom tag.</div>
                </div>

                <h3 class="sectionTitle" style="font-size: 1em; margin: 1.5em 0 0.5em;">Resolution badge</h3>
                <div class="checkboxContainer checkboxContainer-withDescription">
                    <label class="checkboxLabel">
                        <input type="checkbox" id="ShowQuality" />
                        <span>Show resolution badge</span>
                    </label>
                    <div class="fieldDescription">Display quality tier (SD / HD / FHD / UHD or 480p / 720p / 1080p / 4K).</div>
                </div>
                <div class="selectContainer" style="margin-top: 0.5em;">
                    <label class="inputLabel inputLabelUnified" for="UseLetterResolution">Resolution format</label>
                    <select id="UseLetterResolution" name="UseLetterResolution" class="select flex align-items-center">
                        <option value="true">Letters (SD, HD, FHD, UHD)</option>
                        <option value="false">Numbered (480p, 720p, 1080p, 4K)</option>
                    </select>
                    <div class="fieldDescription">SD = below 720p, HD = 720p, FHD = 1080p, UHD = 4K.</div>
                </div>
                <div class="checkboxContainer checkboxContainer-withDescription" style="margin-top: 0.5em;">
                    <label class="checkboxLabel">
                        <input type="checkbox" id="Show4K" />
                        <span>Include 4K / UHD in resolution badge</span>
                    </label>
                </div>
                <div class="checkboxContainer checkboxContainer-withDescription">
                    <label class="checkboxLabel">
                        <input type="checkbox" id="ShowHD" />
                        <span>Include HD / FHD in resolution badge</span>
                    </label>
                </div>

                <h3 class="sectionTitle" style="font-size: 1em; margin: 1.5em 0 0.5em;">External ratings (API)</h3>
                <div class="checkboxContainer checkboxContainer-withDescription">
                    <label class="checkboxLabel">
                        <input type="checkbox" id="UseExternalRatings" />
                        <span>Use external API for IMDb &amp; Rotten Tomatoes</span>
                    </label>
                    <div class="fieldDescription">When enabled and API keys are set, fetch ratings from MDBList (and TMDB) instead of Jellyfin metadata.</div>
                </div>
                <div class="inputContainer">
                    <label class="inputLabel inputLabelUnified" for="MdbListApiKey">MDBList API key</label>
                    <input type="password" id="MdbListApiKey" class="inputControl" autocomplete="off" placeholder="Optional" />
                    <div class="fieldDescription">Get a key at <a href="https://mdblist.com" target="_blank" rel="noopener">mdblist.com</a>. Used for IMDb, Rotten Tomatoes, TMDB, Letterboxd ratings.</div>
                </div>
                <div class="inputContainer" style="margin-top: 0.5em;">
                    <label class="inputLabel inputLabelUnified" for="TmdbApiKey">TMDB API key (optional)</label>
                    <input type="password" id="TmdbApiKey" class="inputControl" autocomplete="off" placeholder="Optional" />
                    <div class="fieldDescription">Get a key at <a href="https://www.themoviedb.org/settings/api" target="_blank" rel="noopener">themoviedb.org</a>. For episode/season ratings.</div>
                </div>

                <h3 class="sectionTitle" style="font-size: 1em; margin: 1.5em 0 0.5em;">Other tags</h3>
                <div class="checkboxContainer checkboxContainer-withDescription">
                    <label class="checkboxLabel">
                        <input type="checkbox" id="ShowAudioLanguageFlags" />
                        <span>Show audio language flags</span>
                    </label>
                    <div class="fieldDescription">Display country flags (e.g. ðŸ‡ºðŸ‡¸ ðŸ‡¬ðŸ‡§) for audio languages.</div>
                </div>
                <div class="checkboxContainer checkboxContainer-withDescription">
                    <label class="checkboxLabel">
                        <input type="checkbox" id="SkipItemsWithNoAudioLanguage" />
                        <span>Skip items with no known audio language</span>
                    </label>
                    <div class="fieldDescription">When audio flags are enabled, do not add poster tags to items with unknown or missing audio language.</div>
                </div>
                <div class="checkboxContainer checkboxContainer-withDescription">
                    <label class="checkboxLabel">
                        <input type="checkbox" id="ShowImdbRating" />
                        <span>Show IMDb rating</span>
                    </label>
                    <div class="fieldDescription">From external API (if enabled) or Jellyfin community rating.</div>
                </div>
                <div class="checkboxContainer checkboxContainer-withDescription">
                    <label class="checkboxLabel">
                        <input type="checkbox" id="ShowRottenTomatoes" />
                        <span>Show Rotten Tomatoes rating</span>
                    </label>
                    <div class="fieldDescription">From external API (if enabled) or Jellyfin critic rating.</div>
                </div>

                <h3 class="sectionTitle" style="font-size: 1em; margin: 1.5em 0 0.5em;">Video &amp; audio quality</h3>
                <div class="checkboxContainer checkboxContainer-withDescription">
                    <label class="checkboxLabel">
                        <input type="checkbox" id="ShowHDR" />
                        <span>Show HDR badge</span>
                    </label>
                    <div class="fieldDescription">Display HDR type: HDR10, HDR10+, Dolby Vision, or HLG when detected.</div>
                </div>
                <div class="checkboxContainer checkboxContainer-withDescription">
                    <label class="checkboxLabel">
                        <input type="checkbox" id="ShowDolbyAtmos" />
                        <span>Show Dolby Atmos</span>
                    </label>
                    <div class="fieldDescription">Show Dolby Atmos badge when the audio track has Atmos.</div>
                </div>
                <div class="checkboxContainer checkboxContainer-withDescription">
                    <label class="checkboxLabel">
                        <input type="checkbox" id="ShowDtsX" />
                        <span>Show DTS:X</span>
                    </label>
                    <div class="fieldDescription">Show DTS:X badge when the audio track has DTS:X.</div>
                </div>

                <h3 class="sectionTitle" style="font-size: 1em; margin: 1.5em 0 0.5em;">Custom tag</h3>
                <div class="checkboxContainer checkboxContainer-withDescription">
                    <label class="checkboxLabel">
                        <input type="checkbox" id="CustomTagEnabled" />
                        <span>Show custom text tag on poster</span>
                    </label>
                    <div class="fieldDescription">Display a custom label (e.g. NEW, FAVORITE) at a chosen position.</div>
                </div>
                <div class="inputContainer" style="margin-top: 0.5em;">
                    <label class="inputLabel inputLabelUnified" for="CustomTagText">Custom tag text</label>
                    <input type="text" id="CustomTagText" class="inputControl" placeholder="e.g. NEW" maxlength="32" />
                </div>
                <div class="selectContainer" style="margin-top: 0.5em;">
                    <label class="inputLabel inputLabelUnified" for="CustomTagPosition">Custom tag position</label>
                    <select id="CustomTagPosition" name="CustomTagPosition" class="select flex align-items-center">
                        <option value="TopLeft">Top Left</option>
                        <option value="TopCenter">Top Center</option>
                        <option value="TopRight">Top Right</option>
                        <option value="BottomLeft">Bottom Left</option>
                        <option value="BottomCenter">Bottom Center</option>
                        <option value="BottomRight">Bottom Right</option>
                    </select>
                </div>

                <h3 class="sectionTitle" style="font-size: 1em; margin: 1.5em 0 0.5em;">Automation</h3>
                <div class="checkboxContainer checkboxContainer-withDescription">
                    <label class="checkboxLabel">
                        <input type="checkbox" id="AutoApplyOnLibraryScan" />
                        <span>Apply poster tags automatically when library scan completes</span>
                    </label>
                    <div class="fieldDescription">When enabled, new and updated items get poster tags without running the scheduled task. Works with real-time library scans (e.g. when new movies are added).</div>
                </div>

                <div style="margin-top: 1.5em;">
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        var PosterTagsConfig = {
            pluginUniqueId: 'a7b8c9d0-e1f2-3456-7890-abcdef123456',
            previewBase: 'Plugins/PosterTags',
            previewItemId: null,
            previewItemName: '',
            previewDebounce: null
        };

        function getAuthHeaders() {
            var token = ApiClient.accessToken();
            return token ? { 'X-Emby-Token': token } : {};
        }

        function buildConfigFromForm() {
            var select = document.querySelector('#LibraryIds');
            var selectedIds = select ? Array.from(select.selectedOptions || []).map(function (o) { return o.value; }) : [];
            return {
                SelectedLibraryIds: selectedIds,
                Show4K: document.querySelector('#Show4K').checked,
                ShowHD: document.querySelector('#ShowHD').checked,
                ShowQuality: document.querySelector('#ShowQuality').checked,
                ShowAudioLanguageFlags: document.querySelector('#ShowAudioLanguageFlags').checked,
                SkipItemsWithNoAudioLanguage: document.querySelector('#SkipItemsWithNoAudioLanguage').checked,
                ShowImdbRating: document.querySelector('#ShowImdbRating').checked,
                ShowRottenTomatoes: document.querySelector('#ShowRottenTomatoes').checked,
                BadgePosition: document.querySelector('#BadgePosition').value || 'BottomLeft',
                UseLetterResolution: document.querySelector('#UseLetterResolution').value === 'true',
                UseExternalRatings: document.querySelector('#UseExternalRatings').checked,
                MdbListApiKey: (document.querySelector('#MdbListApiKey').value || '').trim(),
                TmdbApiKey: (document.querySelector('#TmdbApiKey').value || '').trim(),
                CustomTagEnabled: document.querySelector('#CustomTagEnabled').checked,
                CustomTagText: (document.querySelector('#CustomTagText').value || '').trim(),
                CustomTagPosition: document.querySelector('#CustomTagPosition').value || 'TopLeft',
                TagCurvature: Math.min(100, Math.max(0, parseInt(document.querySelector('#TagCurvature').value, 10) || 0)),
                AutoApplyOnLibraryScan: document.querySelector('#AutoApplyOnLibraryScan').checked,
                ShowHDR: document.querySelector('#ShowHDR').checked,
                ShowDolbyAtmos: document.querySelector('#ShowDolbyAtmos').checked,
                ShowDtsX: document.querySelector('#ShowDtsX').checked
            };
        }

        function setPreviewStatus(msg, isError) {
            var el = document.querySelector('#PreviewStatus');
            if (!el) return;
            el.textContent = msg || '';
            el.style.color = isError ? '#e74c3c' : '';
        }

        function setPreviewLoading(loading) {
            var spinner = document.querySelector('#PreviewSpinner');
            var btn = document.querySelector('#RefreshPreviewBtn');
            if (spinner) spinner.classList.toggle('isLoading', !!loading);
            if (btn) btn.disabled = !!loading;
        }

        function setPreviewImageBlob(blob) {
            var img = document.querySelector('#PreviewImage');
            if (!img) return;
            if (img.src && img.src.indexOf('blob:') === 0) URL.revokeObjectURL(img.src);
            img.src = blob ? URL.createObjectURL(blob) : '';
        }

        function loadPreviewImage(useLiveConfig) {
            var img = document.querySelector('#PreviewImage');
            var label = document.querySelector('#PreviewLabel');
            if (!img || !label) return;
            var itemId = PosterTagsConfig.previewItemId;
            if (!itemId) {
                setPreviewStatus('Pick random first or save to load preview.', true);
                return;
            }
            setPreviewLoading(true);
            setPreviewStatus('Loadingâ€¦');
            var url = ApiClient.getUrl(PosterTagsConfig.previewBase + '/Preview?itemId=' + encodeURIComponent(itemId));
            var opts = { headers: getAuthHeaders(), credentials: 'include' };
            function done(err) {
                setPreviewLoading(false);
                if (err) setPreviewStatus(err, true);
                else setPreviewStatus('');
            }
            if (useLiveConfig) {
                var config = buildConfigFromForm();
                fetch(ApiClient.getUrl(PosterTagsConfig.previewBase + '/Preview'), {
                    method: 'POST',
                    headers: Object.assign({ 'Content-Type': 'application/json' }, getAuthHeaders()),
                    credentials: 'include',
                    body: JSON.stringify({ ItemId: itemId, Config: config })
                }).then(function (r) {
                    if (!r.ok) throw new Error(r.statusText);
                    return r.blob();
                }).then(function (blob) {
                    setPreviewImageBlob(blob);
                    label.textContent = 'Using: ' + (PosterTagsConfig.previewItemName || itemId);
                    done();
                }).catch(function () {
                    done('Preview failed.');
                });
                return;
            }
            fetch(url, opts).then(function (r) {
                if (!r.ok) throw new Error(r.statusText);
                return r.blob();
            }).then(function (blob) {
                setPreviewImageBlob(blob);
                label.textContent = 'Using: ' + (PosterTagsConfig.previewItemName || itemId);
                done();
            }).catch(function () {
                done('Preview failed.');
            });
        }

        function fetchPreviewItemAndImage() {
            setPreviewLoading(true);
            setPreviewStatus('Loadingâ€¦');
            setPreviewImageBlob(null);
            document.querySelector('#PreviewLabel').textContent = 'Using: â€”';
            var url = ApiClient.getUrl(PosterTagsConfig.previewBase + '/PreviewItem');
            fetch(url, { headers: getAuthHeaders(), credentials: 'include' })
                .then(function (r) { return r.ok ? r.json() : Promise.reject(new Error(r.statusText)); })
                .then(function (data) {
                    PosterTagsConfig.previewItemId = data.Id;
                    PosterTagsConfig.previewItemName = data.Name || '';
                    document.querySelector('#PreviewLabel').textContent = 'Using: ' + (data.Name || data.Id) + 'â€¦';
                    return fetch(ApiClient.getUrl(PosterTagsConfig.previewBase + '/Preview?itemId=' + encodeURIComponent(data.Id)), { headers: getAuthHeaders(), credentials: 'include' });
                })
                .then(function (r) {
                    if (!r.ok) throw new Error(r.statusText);
                    return r.blob();
                })
                .then(function (blob) {
                    setPreviewImageBlob(blob);
                    setPreviewStatus('');
                    setPreviewLoading(false);
                })
                .catch(function () {
                    setPreviewStatus('No items with posters in selected libraries.', true);
                    setPreviewLoading(false);
                });
        }

        document.querySelector('#PosterTagsConfigPage').addEventListener('pageshow', function () {
            Dashboard.showLoadingMsg();
            ApiClient.getPluginConfiguration(PosterTagsConfig.pluginUniqueId).then(function (config) {
                if (config) {
                    document.querySelector('#Show4K').checked = config.Show4K !== false;
                    document.querySelector('#ShowHD').checked = config.ShowHD !== false;
                    document.querySelector('#ShowQuality').checked = config.ShowQuality !== false;
                    document.querySelector('#ShowAudioLanguageFlags').checked = config.ShowAudioLanguageFlags !== false;
                    document.querySelector('#SkipItemsWithNoAudioLanguage').checked = config.SkipItemsWithNoAudioLanguage !== false;
                    document.querySelector('#ShowImdbRating').checked = config.ShowImdbRating !== false;
                    document.querySelector('#ShowRottenTomatoes').checked = config.ShowRottenTomatoes !== false;
                    document.querySelector('#BadgePosition').value = config.BadgePosition || 'BottomLeft';
                    document.querySelector('#UseLetterResolution').value = config.UseLetterResolution !== false ? 'true' : 'false';
                    document.querySelector('#UseExternalRatings').checked = config.UseExternalRatings === true;
                    document.querySelector('#MdbListApiKey').value = config.MdbListApiKey || '';
                    document.querySelector('#TmdbApiKey').value = config.TmdbApiKey || '';
                    document.querySelector('#CustomTagEnabled').checked = config.CustomTagEnabled === true;
                    document.querySelector('#CustomTagText').value = config.CustomTagText || '';
                    document.querySelector('#CustomTagPosition').value = config.CustomTagPosition || 'TopLeft';
                    document.querySelector('#TagCurvature').value = Math.min(100, Math.max(0, parseInt(config.TagCurvature, 10) || 0));
                    document.querySelector('#AutoApplyOnLibraryScan').checked = config.AutoApplyOnLibraryScan !== false;
                    document.querySelector('#ShowHDR').checked = config.ShowHDR !== false;
                    document.querySelector('#ShowDolbyAtmos').checked = config.ShowDolbyAtmos !== false;
                    document.querySelector('#ShowDtsX').checked = config.ShowDtsX !== false;
                    updateCurvatureLabel(parseInt(document.querySelector('#TagCurvature').value, 10));
                    loadLibraries(config.SelectedLibraryIds || []);
                    fetchPreviewItemAndImage();
                }
                Dashboard.hideLoadingMsg();
            }).catch(function () {
                Dashboard.hideLoadingMsg();
            });
        });

        document.querySelector('#RefreshPreviewBtn').addEventListener('click', function () {
            fetchPreviewItemAndImage();
        });

        function scheduleLivePreview() {
            if (PosterTagsConfig.previewDebounce) clearTimeout(PosterTagsConfig.previewDebounce);
            PosterTagsConfig.previewDebounce = setTimeout(function () {
                PosterTagsConfig.previewDebounce = null;
                if (PosterTagsConfig.previewItemId) loadPreviewImage(true);
            }, 1200);
        }
        ['Show4K', 'ShowHD', 'ShowQuality', 'ShowAudioLanguageFlags', 'SkipItemsWithNoAudioLanguage', 'ShowImdbRating', 'ShowRottenTomatoes', 'BadgePosition', 'UseLetterResolution', 'UseExternalRatings', 'CustomTagEnabled', 'CustomTagText', 'CustomTagPosition', 'TagCurvature', 'ShowHDR', 'ShowDolbyAtmos', 'ShowDtsX'].forEach(function (id) {
            var el = document.querySelector('#' + id);
            if (el) el.addEventListener('change', scheduleLivePreview);
            if (id === 'TagCurvature') {
                var curv = document.querySelector('#TagCurvature');
                if (curv) curv.addEventListener('input', scheduleLivePreview);
            }
        });

        function updateCurvatureLabel(val) {
            var el = document.querySelector('#TagCurvatureLabel');
            if (!el) return;
            if (val <= 0) el.textContent = '0 â€” Rectangle';
            else if (val >= 100) el.textContent = '100 â€” Pill';
            else el.textContent = val + ' â€” Rounded';
        }
        document.querySelector('#TagCurvature').addEventListener('input', function () {
            updateCurvatureLabel(parseInt(this.value, 10));
        });

        function loadLibraries(selectedIds) {
            ApiClient.getViews().then(function (views) {
                var select = document.querySelector('#LibraryIds');
                if (!select) return;
                select.innerHTML = '';
                if (views && views.Items) {
                    views.Items.forEach(function (view) {
                        var option = document.createElement('option');
                        option.value = view.Id;
                        option.textContent = view.Name || view.Id;
                        option.selected = selectedIds.indexOf(view.Id) !== -1;
                        select.appendChild(option);
                    });
                }
            }).catch(function () {});
        }

        document.querySelector('#PosterTagsConfigForm').addEventListener('submit', function (e) {
            e.preventDefault();
            Dashboard.showLoadingMsg();
            var select = document.querySelector('#LibraryIds');
            var selectedIds = select ? Array.from(select.selectedOptions || []).map(function (o) { return o.value; }) : [];
            ApiClient.getPluginConfiguration(PosterTagsConfig.pluginUniqueId).then(function (config) {
                if (!config) config = {};
                config.Show4K = document.querySelector('#Show4K').checked;
                config.ShowHD = document.querySelector('#ShowHD').checked;
                config.ShowQuality = document.querySelector('#ShowQuality').checked;
                config.ShowAudioLanguageFlags = document.querySelector('#ShowAudioLanguageFlags').checked;
                config.SkipItemsWithNoAudioLanguage = document.querySelector('#SkipItemsWithNoAudioLanguage').checked;
                config.ShowImdbRating = document.querySelector('#ShowImdbRating').checked;
                config.ShowRottenTomatoes = document.querySelector('#ShowRottenTomatoes').checked;
                config.BadgePosition = document.querySelector('#BadgePosition').value || 'BottomLeft';
                config.UseLetterResolution = document.querySelector('#UseLetterResolution').value === 'true';
                config.UseExternalRatings = document.querySelector('#UseExternalRatings').checked;
                config.MdbListApiKey = (document.querySelector('#MdbListApiKey').value || '').trim();
                config.TmdbApiKey = (document.querySelector('#TmdbApiKey').value || '').trim();
                config.CustomTagEnabled = document.querySelector('#CustomTagEnabled').checked;
                config.CustomTagText = (document.querySelector('#CustomTagText').value || '').trim();
                config.CustomTagPosition = document.querySelector('#CustomTagPosition').value || 'TopLeft';
                config.TagCurvature = Math.min(100, Math.max(0, parseInt(document.querySelector('#TagCurvature').value, 10) || 0));
                config.AutoApplyOnLibraryScan = document.querySelector('#AutoApplyOnLibraryScan').checked;
                config.ShowHDR = document.querySelector('#ShowHDR').checked;
                config.ShowDolbyAtmos = document.querySelector('#ShowDolbyAtmos').checked;
                config.ShowDtsX = document.querySelector('#ShowDtsX').checked;
                config.SelectedLibraryIds = selectedIds;
                ApiClient.updatePluginConfiguration(PosterTagsConfig.pluginUniqueId, config).then(function (result) {
                    Dashboard.processPluginConfigurationUpdateResult(result);
                }).catch(function () {
                    Dashboard.hideLoadingMsg();
                });
            }).catch(function () {
                Dashboard.hideLoadingMsg();
            });
            return false;
        });
    </script>
</body>
</html>
