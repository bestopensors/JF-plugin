<style>
            #PosterTagsConfigPage { box-sizing: border-box; position: relative; pointer-events: auto; z-index: 1; max-width: 100%; }
            .postertags-page { max-width: 100%; margin: 0; padding: 2rem 2rem 3rem 3rem; color: #e4e4e7; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; font-size: 14px; line-height: 1.55; }
            .postertags-layout { display: flex; gap: 2rem; align-items: flex-start; max-width: min(1200px, 100%); margin: 0 auto; width: 100%; min-height: 0; }
            .postertags-main { flex: 1; min-width: 0; max-width: 720px; overflow-x: hidden; }
            .postertags-preview-sidebar { width: 300px; min-width: 260px; flex-shrink: 0; align-self: flex-start; position: sticky; top: 1rem; }
            .postertags-preview-sidebar .sectionTitle { margin-top: 0; }
            .postertags-page .postertags-version { margin: 0 0 1rem; font-size: 0.8rem; color: #71717a; }
            .postertags-page .sectionTitleContainer { margin-bottom: 0.5rem; }
            .postertags-page .sectionTitle { font-size: 1.5rem; font-weight: 600; margin: 0; color: #fff; letter-spacing: -0.02em; }
            .postertags-page .sectionContentContainer { background: rgba(255,255,255,0.04); border-radius: 12px; padding: 1.5rem 1.75rem; margin-top: 1rem; border: 1px solid rgba(255,255,255,0.06); box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
            .postertags-page .fieldDescription { color: #a1a1aa; font-size: 0.875rem; margin: 0.4rem 0 1rem; line-height: 1.5; }
            .postertags-page h3.sectionTitle { font-size: 0.9375rem; font-weight: 600; color: #f4f4f5; margin: 1.75rem 0 0.5rem; padding-bottom: 0.35rem; letter-spacing: 0.01em; }
            .postertags-page h3.sectionTitle:first-of-type { margin-top: 0; }
            .postertags-page .selectContainer, .postertags-page .inputContainer, .postertags-page .checkboxContainer { margin-bottom: 0.75rem; }
            .postertags-page .inputLabel, .postertags-page .checkboxLabel { font-weight: 500; color: #e4e4e7; }
            .postertags-page select.select { appearance: none; background: rgba(0,0,0,0.35) url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12"><path fill="%23a1a1aa" d="M2.5 4.5L6 8l3.5-3.5"/></svg>') no-repeat right 0.75rem center; border: 1px solid rgba(255,255,255,0.12); border-radius: 8px; color: #e4e4e7; padding: 0.5rem 2rem 0.5rem 0.75rem; min-height: 40px; font-size: 0.9375rem; cursor: pointer; transition: border-color 0.15s, box-shadow 0.15s; }
            .postertags-page select.select:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.2); }
            .postertags-page .inputControl { background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.12); border-radius: 8px; color: #e4e4e7; padding: 0.5rem 0.75rem; min-height: 40px; font-size: 0.9375rem; transition: border-color 0.15s, box-shadow 0.15s; }
            .postertags-page .inputControl:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.2); }
            .postertags-page .inputControl::placeholder { color: #71717a; }
            .postertags-page .btn { padding: 0.5rem 1.25rem; border-radius: 8px; font-weight: 500; font-size: 0.9375rem; cursor: pointer; border: none; transition: background 0.15s, transform 0.05s; }
            .postertags-page .btn:active { transform: scale(0.98); }
            .postertags-page .btn-primary { background: #3b82f6; color: #fff; }
            .postertags-page .btn-primary:hover { background: #2563eb; }
            .postertags-page .btn-secondary { background: rgba(255,255,255,0.08); color: #e4e4e7; border: 1px solid rgba(255,255,255,0.12); }
            .postertags-page .btn-secondary:hover { background: rgba(255,255,255,0.12); border-color: rgba(255,255,255,0.18); }
            .postertags-page a { color: #60a5fa; text-decoration: none; }
            .postertags-page a:hover { text-decoration: underline; }
            .postertags-page input[type="checkbox"] { width: 1.125rem; height: 1.125rem; margin: 0 0.5rem 0 0; accent-color: #3b82f6; cursor: pointer; flex-shrink: 0; }
            .postertags-page input[type="range"] { accent-color: #3b82f6; height: 8px; border-radius: 4px; flex: 1; min-width: 120px; max-width: 280px; }
            .postertags-slider-row { display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; margin-bottom: 0.5rem; }
            .postertags-slider-row .postertags-slider-value { min-width: 3.5em; font-weight: 500; color: #a1a1aa; font-size: 0.9rem; }
            .postertags-tag-row { display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; margin-bottom: 0.6rem; }
            .postertags-tag-row .tag-check { flex-shrink: 0; }
            .postertags-tag-row .tag-position { min-width: 140px; flex: 0 1 auto; }
            .postertags-tag-row .tag-position select { width: 100%; }
            .postertags-page input[type="color"] { width: 2.5rem; height: 2rem; padding: 2px; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; cursor: pointer; background: transparent; }
            .postertags-tag-section { font-size: 0.8125rem; overflow-x: auto; padding-bottom: 0.25rem; }
            .postertags-tag-section::-webkit-scrollbar { height: 6px; }
            .postertags-tag-section::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }
            .postertags-color-row { display: flex; align-items: center; gap: 0.45rem; margin-bottom: 0.35rem; flex-wrap: nowrap; min-height: 0; overflow-x: auto; }
            .postertags-color-row .postertags-row-cb { position: absolute; opacity: 0; pointer-events: none; width: 0; height: 0; }
            .postertags-tag-btn { display: inline-block; padding: 0.25rem 0.5rem; border-radius: 999px; font-weight: 500; font-size: inherit; cursor: pointer; border: 1px solid rgba(255,255,255,0.3); background: transparent; color: #e4e4e7; transition: background 0.15s, border-color 0.15s, color 0.15s; user-select: none; flex-shrink: 0; white-space: nowrap; }
            .postertags-tag-btn:hover { border-color: rgba(255,255,255,0.5); color: #fff; }
            .postertags-color-row:has(.postertags-row-cb:checked) .postertags-tag-btn { background: #3b82f6; border-color: #3b82f6; color: #fff; }
            .postertags-color-row .tag-custom-input { width: 5em; min-width: 4em; flex-shrink: 0; padding: 0.3rem 0.5rem; min-height: 28px; font-size: inherit; }
            .postertags-color-row .tag-format-select { min-width: 0; width: 5em; flex-shrink: 0; padding: 0.3rem 1.5rem 0.3rem 0.5rem; min-height: 28px; font-size: inherit; background-size: 8px 8px; background-position: right 0.4rem center; }
            .postertags-color-row input[type="color"] { width: 2rem; height: 1.6rem; flex-shrink: 0; }
            .postertags-color-row .tag-hex-input { width: 5.5em; min-width: 0; flex-shrink: 1; padding: 0.3rem 0.5rem; min-height: 28px; font-size: inherit; }
            .postertags-opacity-pill { display: flex; align-items: center; gap: 0.2rem; flex-shrink: 0; }
            .postertags-opacity-pill input[type="range"] { width: 3rem; min-width: 3rem; max-width: 3rem; margin: 0; height: 4px; }
            .postertags-opacity-pill .opacity-val { font-size: 0.75rem; color: #a1a1aa; min-width: 2em; }
            .postertags-info-icon { display: inline-flex; align-items: center; justify-content: center; width: 1rem; height: 1rem; border-radius: 50%; background: rgba(255,255,255,0.15); color: #a1a1aa; font-size: 0.65rem; font-weight: 700; cursor: help; flex-shrink: 0; }
            .postertags-info-icon:hover { background: rgba(255,255,255,0.25); color: #e4e4e7; }
            .postertags-color-row .tag-position-select { min-width: 0; width: 6.5em; flex-shrink: 0; padding: 0.3rem 1.5rem 0.3rem 0.5rem; min-height: 28px; font-size: inherit; background-size: 8px 8px; background-position: right 0.4rem center; }
            @media (max-width: 640px) { .postertags-color-row { flex-wrap: wrap; } }
            #PreviewContainer { border-radius: 12px; border: 1px solid rgba(255,255,255,0.06); background: rgba(0,0,0,0.2); box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
            .postertags-preview-placeholder { display: flex; align-items: center; justify-content: center; min-height: 200px; padding: 1.5rem; color: #71717a; font-size: 0.9rem; text-align: center; background: rgba(0,0,0,0.15); border-radius: 8px; }
            #PreviewImageWrap.has-image .postertags-preview-placeholder { display: none; }
            #PreviewImageWrap { overflow: hidden; border-radius: 8px; }
            #PreviewImageWrap .postertags-preview-img { display: none; max-width: 100%; width: 100%; height: auto; max-height: 420px; object-fit: contain; border-radius: 8px; min-height: 200px; background: rgba(0,0,0,0.3); }
            #PreviewImageWrap.has-image .postertags-preview-img { display: block; }
            .library-cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 0.65rem; margin: 0.5rem 0 1rem; }
            .library-card { display: flex; align-items: center; gap: 0.5rem; padding: 0.7rem 0.9rem; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; cursor: pointer; transition: background 0.15s, border-color 0.15s, box-shadow 0.15s; pointer-events: auto; user-select: none; -webkit-user-select: none; }
            .library-card:hover { background: rgba(255,255,255,0.09); border-color: rgba(255,255,255,0.18); box-shadow: 0 2px 4px rgba(0,0,0,0.15); }
            .library-card input[type="checkbox"] { margin: 0; flex-shrink: 0; }
            .library-card .library-name { font-weight: 500; color: #e4e4e7; word-break: break-word; font-size: 0.9rem; }
        </style>
        <div id="PosterTagsConfigPage" class="configPage postertags-page" style="min-height:200px;">
        <p id="PosterTagsVersion" class="postertags-version">Poster Tags plugin version: <strong>{{POSTERTAGS_VERSION}}</strong></p>
        <script>
            (function(){
                try {
                    var v = '{{POSTERTAGS_VERSION}}';
                    if (window.console && window.console.log) {
                        window.console.log('[Poster Tags] Plugin version:', v);
                    }
                } catch (e) { if (window.console) window.console.log('[Poster Tags] log error', e); }
            })();
        </script>
        <div class="sectionTitleContainer flex align-items-center">
            <h2 class="sectionTitle">Poster Tags — Settings</h2>
        </div>
        <div class="postertags-layout">
        <div class="postertags-main">
        <div class="sectionContentContainer sectionContentContainerBorderNoPadding" style="border: none;">
            <form id="PosterTagsConfigForm">
                <p class="fieldDescription" style="margin-bottom: 1.5rem;">
                    Configure how tags are embedded on library posters. With <strong>Apply automatically after library scan</strong> enabled, new movies and series get tags without running a task. You can also run the <strong>Add Poster Tags</strong> scheduled task (Dashboard → Scheduled Tasks) to apply to existing items.
                </p>
                <p class="fieldDescription" style="margin-bottom: 1.25rem; padding: 0.6rem 0.75rem; background: rgba(59,130,246,0.12); border-radius: 8px; border: 1px solid rgba(59,130,246,0.2); color: #93c5fd;">
                    <strong>Live preview</strong> uses your current settings — no need to save. Enable badges or custom tag and click <strong>Pick random &amp; refresh</strong> to see them on the poster.
                </p>

                <h3 class="sectionTitle" style="font-size: 1em; margin: 1em 0 0.5em;">Libraries to process</h3>
                <p class="fieldDescription" style="margin-bottom: 0.5rem;">Select which libraries to add poster tags to. Leave all unchecked to process all libraries.</p>
                <div id="LibraryCardsContainer" class="library-cards-grid"></div>

                <h3 class="sectionTitle" style="font-size: 1em; margin: 1.5em 0 0.5em;">Size &amp; shape</h3>
                <p class="fieldDescription" style="margin-bottom: 0.75rem;">Control the size and corner style of all tag badges.</p>
                <div class="inputContainer">
                    <label class="inputLabel inputLabelUnified" for="TagSize">Tag size</label>
                    <div class="postertags-slider-row">
                        <input type="range" id="TagSize" name="TagSize" min="12" max="100" value="18" />
                        <span id="TagSizeLabel" class="postertags-slider-value">18px</span>
                    </div>
                    <div class="fieldDescription">Font size for all tags (12–100px). Move the slider to preview.</div>
                </div>
                <div class="inputContainer" style="margin-top: 0.75rem;">
                    <label class="inputLabel inputLabelUnified" for="TagCurvature">Tag edge curvature</label>
                    <div class="postertags-slider-row">
                        <input type="range" id="TagCurvature" name="TagCurvature" min="0" max="100" value="0" />
                        <span id="TagCurvatureLabel" class="postertags-slider-value">0 — Rectangle</span>
                    </div>
                    <div class="fieldDescription">0 = sharp rectangle, 100 = pill.</div>
                </div>

                <h3 class="sectionTitle" style="font-size: 1em; margin: 1.5em 0 0.5em;">Tag colors</h3>
                <p class="fieldDescription" style="margin-bottom: 0.5rem;">Click a tag name to enable or disable. Format, color, opacity, position per tag.</p>
                <div class="postertags-tag-section">
                <div class="postertags-color-row">
                    <span class="postertags-info-icon" title="Shows quality tier (SD, HD, FHD, UHD or 480p, 720p, 1080p, 4K)">i</span>
                    <input type="checkbox" id="ShowQuality" class="postertags-row-cb" />
                    <label for="ShowQuality" class="postertags-tag-btn">Resolution</label>
                    <select id="ResolutionFormat" name="ResolutionFormat" class="select tag-format-select">
                        <option value="0">Letters</option>
                        <option value="1">Numbers</option>
                        <option value="2">Both</option>
                    </select>
                    <input type="color" id="ResolutionColor" value="#000000" />
                    <input type="text" id="ResolutionColorHex" class="inputControl tag-hex-input" placeholder="#000000" maxlength="9" />
                    <div class="postertags-opacity-pill"><input type="range" id="ResolutionOpacity" min="0" max="100" value="100" /><span id="ResolutionOpacityVal" class="opacity-val">100%</span></div>
                    <select id="ResolutionPosition" name="ResolutionPosition" class="select tag-position-select">
                        <option value="TopLeft">Top Left</option>
                        <option value="TopCenter">Top Center</option>
                        <option value="TopRight">Top Right</option>
                        <option value="BottomLeft">Bottom Left</option>
                        <option value="BottomCenter">Bottom Center</option>
                        <option value="BottomRight">Bottom Right</option>
                    </select>
                </div>
                <div class="postertags-color-row">
                    <span class="postertags-info-icon" title="Shows IMDb rating from API or Jellyfin community rating">i</span>
                    <input type="checkbox" id="ShowImdbRating" class="postertags-row-cb" />
                    <label for="ShowImdbRating" class="postertags-tag-btn">IMDb</label>
                    <input type="color" id="ImdbColor" value="#000000" />
                    <input type="text" id="ImdbColorHex" class="inputControl tag-hex-input" placeholder="#000000" maxlength="9" />
                    <div class="postertags-opacity-pill"><input type="range" id="ImdbOpacity" min="0" max="100" value="100" /><span id="ImdbOpacityVal" class="opacity-val">100%</span></div>
                    <select id="ImdbPosition" name="ImdbPosition" class="select tag-position-select">
                        <option value="TopLeft">Top Left</option>
                        <option value="TopCenter">Top Center</option>
                        <option value="TopRight">Top Right</option>
                        <option value="BottomLeft">Bottom Left</option>
                        <option value="BottomCenter">Bottom Center</option>
                        <option value="BottomRight">Bottom Right</option>
                    </select>
                </div>
                <div class="postertags-color-row">
                    <span class="postertags-info-icon" title="Shows Rotten Tomatoes critic score">i</span>
                    <input type="checkbox" id="ShowRottenTomatoes" class="postertags-row-cb" />
                    <label for="ShowRottenTomatoes" class="postertags-tag-btn">Rotten Tomatoes</label>
                    <input type="color" id="RottenTomatoesColor" value="#000000" />
                    <input type="text" id="RottenTomatoesColorHex" class="inputControl" placeholder="#000000" maxlength="9" style="width: 7em;" />
                    <div class="postertags-opacity-pill"><input type="range" id="RottenTomatoesOpacity" min="0" max="100" value="100" /><span id="RottenTomatoesOpacityVal" class="opacity-val">100%</span></div>
                    <select id="RottenTomatoesPosition" name="RottenTomatoesPosition" class="select tag-position-select">
                        <option value="TopLeft">Top Left</option>
                        <option value="TopCenter">Top Center</option>
                        <option value="TopRight">Top Right</option>
                        <option value="BottomLeft">Bottom Left</option>
                        <option value="BottomCenter">Bottom Center</option>
                        <option value="BottomRight">Bottom Right</option>
                    </select>
                </div>
                <div class="postertags-color-row">
                    <span class="postertags-info-icon" title="Shows HDR type (HDR10, HDR10+, Dolby Vision, HLG) when detected">i</span>
                    <input type="checkbox" id="ShowHDR" class="postertags-row-cb" />
                    <label for="ShowHDR" class="postertags-tag-btn">HDR</label>
                    <input type="color" id="HdrColor" value="#000000" />
                    <input type="text" id="HdrColorHex" class="inputControl tag-hex-input" placeholder="#000000" maxlength="9" />
                    <div class="postertags-opacity-pill"><input type="range" id="HdrOpacity" min="0" max="100" value="100" /><span id="HdrOpacityVal" class="opacity-val">100%</span></div>
                    <select id="HdrPosition" name="HdrPosition" class="select tag-position-select">
                        <option value="TopLeft">Top Left</option>
                        <option value="TopCenter">Top Center</option>
                        <option value="TopRight">Top Right</option>
                        <option value="BottomLeft">Bottom Left</option>
                        <option value="BottomCenter">Bottom Center</option>
                        <option value="BottomRight">Bottom Right</option>
                    </select>
                </div>
                <div class="postertags-color-row">
                    <span class="postertags-info-icon" title="Shows Dolby Atmos and/or DTS:X when present in audio">i</span>
                    <input type="checkbox" id="ShowDolbyAtmos" class="postertags-row-cb" />
                    <label for="ShowDolbyAtmos" class="postertags-tag-btn">Audio (Dolby/DTS)</label>
                    <input type="color" id="AudioColor" value="#000000" />
                    <input type="text" id="AudioColorHex" class="inputControl tag-hex-input" placeholder="#000000" maxlength="9" />
                    <div class="postertags-opacity-pill"><input type="range" id="AudioOpacity" min="0" max="100" value="100" /><span id="AudioOpacityVal" class="opacity-val">100%</span></div>
                    <select id="AudioPosition" name="AudioPosition" class="select tag-position-select">
                        <option value="TopLeft">Top Left</option>
                        <option value="TopCenter">Top Center</option>
                        <option value="TopRight">Top Right</option>
                        <option value="BottomLeft">Bottom Left</option>
                        <option value="BottomCenter">Bottom Center</option>
                        <option value="BottomRight">Bottom Right</option>
                    </select>
                </div>
                <div class="postertags-color-row">
                    <span class="postertags-info-icon" title="Shows country flags for audio languages">i</span>
                    <input type="checkbox" id="ShowAudioLanguageFlags" class="postertags-row-cb" />
                    <label for="ShowAudioLanguageFlags" class="postertags-tag-btn">Audio flags</label>
                    <input type="color" id="AudioFlagsColor" value="#000000" />
                    <input type="text" id="AudioFlagsColorHex" class="inputControl tag-hex-input" placeholder="#000000" maxlength="9" />
                    <div class="postertags-opacity-pill"><input type="range" id="AudioFlagsOpacity" min="0" max="100" value="100" /><span id="AudioFlagsOpacityVal" class="opacity-val">100%</span></div>
                    <select id="AudioFlagsPosition" name="AudioFlagsPosition" class="select tag-position-select">
                        <option value="TopLeft">Top Left</option>
                        <option value="TopCenter">Top Center</option>
                        <option value="TopRight">Top Right</option>
                        <option value="BottomLeft">Bottom Left</option>
                        <option value="BottomCenter">Bottom Center</option>
                        <option value="BottomRight">Bottom Right</option>
                    </select>
                </div>
                <div class="postertags-color-row">
                    <span class="postertags-info-icon" title="Custom text label (e.g. NEW, FAVORITE)">i</span>
                    <input type="checkbox" id="CustomTagEnabled" class="postertags-row-cb" />
                    <label for="CustomTagEnabled" class="postertags-tag-btn">Custom tag</label>
                    <input type="text" id="CustomTagText" class="inputControl tag-custom-input" placeholder="e.g. NEW" maxlength="32" />
                    <input type="color" id="CustomTagColor" value="#000000" />
                    <input type="text" id="CustomTagColorHex" class="inputControl tag-hex-input" placeholder="#000000" maxlength="9" />
                    <div class="postertags-opacity-pill"><input type="range" id="CustomTagOpacity" min="0" max="100" value="100" /><span id="CustomTagOpacityVal" class="opacity-val">100%</span></div>
                    <select id="CustomTagPosition" name="CustomTagPosition" class="select tag-position-select">
                        <option value="TopLeft">Top Left</option>
                        <option value="TopCenter">Top Center</option>
                        <option value="TopRight">Top Right</option>
                        <option value="BottomLeft">Bottom Left</option>
                        <option value="BottomCenter">Bottom Center</option>
                        <option value="BottomRight">Bottom Right</option>
                    </select>
                </div>
                <p class="fieldDescription" style="margin-top: 0.35rem; font-size: 0.8125rem;">Hex: #RRGGBB or #AARRGGBB. Opacity 0–100%.</p>
                </div>
                <div class="checkboxContainer" style="margin-top: 0.5rem;">
                    <label class="checkboxLabel"><input type="checkbox" id="Show4K" /><span>Resolution: include 4K / UHD</span></label>
                    <label class="checkboxLabel" style="margin-left: 1rem;"><input type="checkbox" id="ShowHD" /><span>Include HD / FHD</span></label>
                </div>
                <div class="checkboxContainer" style="margin-top: 0.35rem;">
                    <label class="checkboxLabel"><input type="checkbox" id="SkipItemsWithNoAudioLanguage" /><span>Skip items with no known audio language</span></label>
                </div>
                <div class="checkboxContainer" style="margin-top: 0.35rem;">
                    <label class="checkboxLabel"><input type="checkbox" id="ShowDtsX" /><span>Audio: also show DTS:X (with Dolby Atmos)</span></label>
                </div>

                <h3 class="sectionTitle" style="font-size: 1em; margin: 1.5em 0 0.5em;">External ratings (API)</h3>
                <div class="checkboxContainer checkboxContainer-withDescription">
                    <label class="checkboxLabel">
                        <input type="checkbox" id="UseExternalRatings" />
                        <span>Use external API for IMDb &amp; Rotten Tomatoes</span>
                    </label>
                    <div class="fieldDescription">When enabled and API keys are set, fetch ratings from MDBList (and TMDB) instead of Jellyfin metadata.</div>
                </div>
                <div class="inputContainer">
                    <label class="inputLabel inputLabelUnified" for="MdbListApiKey">MDBList API key</label>
                    <input type="password" id="MdbListApiKey" class="inputControl" autocomplete="off" placeholder="Optional" />
                    <div class="fieldDescription">Get a key at <a href="https://mdblist.com" target="_blank" rel="noopener">mdblist.com</a>. Used for IMDb, Rotten Tomatoes, TMDB, Letterboxd ratings.</div>
                </div>
                <div class="inputContainer" style="margin-top: 0.5em;">
                    <label class="inputLabel inputLabelUnified" for="TmdbApiKey">TMDB API key (optional)</label>
                    <input type="password" id="TmdbApiKey" class="inputControl" autocomplete="off" placeholder="Optional" />
                    <div class="fieldDescription">Get a key at <a href="https://www.themoviedb.org/settings/api" target="_blank" rel="noopener">themoviedb.org</a>. For episode/season ratings.</div>
                </div>

                <h3 class="sectionTitle" style="font-size: 1em; margin: 1.5em 0 0.5em;">Automation</h3>
                <div class="checkboxContainer checkboxContainer-withDescription">
                    <label class="checkboxLabel">
                        <input type="checkbox" id="AutoApplyOnLibraryScan" />
                        <span>Apply poster tags automatically when library scan completes</span>
                    </label>
                    <div class="fieldDescription">When enabled, new and updated items get poster tags without running the scheduled task. Works with real-time library scans (e.g. when new movies are added).</div>
                </div>

                <div style="margin-top: 2rem; padding-top: 1rem;">
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
        </div>
        <aside class="postertags-preview-sidebar">
                <h3 class="sectionTitle" style="font-size: 1em; margin: 0 0 0.5em;">Live preview</h3>
                <p class="fieldDescription" style="margin-bottom: 0.75rem;">Uses your current settings (no save needed). Pick a random poster to see badges and custom tag.</p>
                <div id="PreviewContainer" style="margin: 0; padding: 1.1em; border-radius: 12px;">
                    <div id="PreviewLabel" style="margin-bottom: 0.5em; font-weight: 500;">Using: —</div>
                    <div id="PreviewImageWrap" style="position: relative; display: inline-block; min-height: 200px; width: 100%;">
                        <div id="PreviewSpinner" class="posterTagsSpinner" style="display: none; position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%); width: 48px; height: 48px; border: 4px solid rgba(255,255,255,0.3); border-top-color: #fff; border-radius: 50%; animation: posterTagsSpin 0.8s linear infinite;"></div>
                        <div id="PreviewPlaceholder" class="postertags-preview-placeholder">Nothing to preview. Please click the random button below.</div>
                        <img id="PreviewImage" class="postertags-preview-img" alt="Preview" />
                    </div>
                    <div style="margin-top: 0.75em;">
                        <button type="button" id="RefreshPreviewBtn" class="btn btn-secondary">Pick random &amp; refresh</button>
                        <span id="PreviewStatus" style="display: block; margin-top: 0.35em; font-size: 0.9em;"></span>
                    </div>
                </div>
        </aside>
        </div>
        <style>
            @keyframes posterTagsSpin { to { transform: translate(-50%,-50%) rotate(360deg); } }
            .posterTagsSpinner.isLoading { display: block !important; }
        </style>
        </div>
    <script>
        (function () {
            if (typeof window.ApiClient === 'undefined' && window.parent && typeof window.parent.ApiClient !== 'undefined') {
                window.ApiClient = window.parent.ApiClient;
                window.Dashboard = window.parent.Dashboard;
            }
        })();
        try { if (window.console) window.console.log('[Poster Tags] ApiClient=', typeof ApiClient, 'Dashboard=', typeof Dashboard); } catch (e) {}
        (function () {
            if (typeof ApiClient === 'undefined' || typeof Dashboard === 'undefined') {
                var msg = document.createElement('p');
                msg.className = 'fieldDescription';
                msg.style.cssText = 'color:#e74c3c;margin:1em;';
                msg.textContent = 'Poster Tags: Jellyfin API (ApiClient/Dashboard) not available. Open Settings from Dashboard → Plugins → Poster Tags.';
                var root = document.querySelector('#PosterTagsConfigPage');
                if (root && root.firstChild) root.insertBefore(msg, root.firstChild);
                else if (root) root.appendChild(msg);
                return;
            }
        })();
        var PosterTagsConfig = {
            pluginUniqueId: 'a7b8c9d0-e1f2-3456-7890-abcdef123456',
            previewBase: 'Plugins/PosterTags',
            previewItemId: null,
            previewItemName: '',
            previewDebounce: null
        };

        function getAuthHeaders() {
            var token = typeof ApiClient !== 'undefined' ? ApiClient.accessToken() : null;
            return token ? { 'X-Emby-Token': token } : {};
        }

        function buildConfigFromForm() {
            var selectedIds = [];
            document.querySelectorAll('input[name="LibraryIds"]:checked').forEach(function (cb) { selectedIds.push(cb.value); });
            return {
                SelectedLibraryIds: selectedIds,
                Show4K: document.querySelector('#Show4K').checked,
                ShowHD: document.querySelector('#ShowHD').checked,
                ShowQuality: document.querySelector('#ShowQuality').checked,
                ShowAudioLanguageFlags: document.querySelector('#ShowAudioLanguageFlags').checked,
                SkipItemsWithNoAudioLanguage: document.querySelector('#SkipItemsWithNoAudioLanguage').checked,
                ShowImdbRating: document.querySelector('#ShowImdbRating').checked,
                ShowRottenTomatoes: document.querySelector('#ShowRottenTomatoes').checked,
                UseExternalRatings: document.querySelector('#UseExternalRatings').checked,
                MdbListApiKey: (document.querySelector('#MdbListApiKey').value || '').trim(),
                TmdbApiKey: (document.querySelector('#TmdbApiKey').value || '').trim(),
                CustomTagEnabled: document.querySelector('#CustomTagEnabled').checked,
                CustomTagText: (document.querySelector('#CustomTagText').value || '').trim(),
                CustomTagPosition: document.querySelector('#CustomTagPosition').value || 'TopLeft',
                TagCurvature: Math.min(100, Math.max(0, parseInt(document.querySelector('#TagCurvature').value, 10) || 0)),
                TagSize: Math.min(100, Math.max(12, parseInt(document.querySelector('#TagSize').value, 10) || 18)),
                ResolutionFormat: Math.min(2, Math.max(0, parseInt(document.querySelector('#ResolutionFormat').value, 10) || 0)),
                ResolutionPosition: document.querySelector('#ResolutionPosition').value || 'BottomLeft',
                ImdbPosition: document.querySelector('#ImdbPosition').value || 'BottomLeft',
                RottenTomatoesPosition: document.querySelector('#RottenTomatoesPosition').value || 'BottomLeft',
                HdrPosition: document.querySelector('#HdrPosition').value || 'BottomLeft',
                AudioPosition: document.querySelector('#AudioPosition').value || 'BottomLeft',
                AudioFlagsPosition: document.querySelector('#AudioFlagsPosition').value || 'BottomLeft',
                ResolutionColor: getColorValue('ResolutionColor'),
                ImdbColor: getColorValue('ImdbColor'),
                RottenTomatoesColor: getColorValue('RottenTomatoesColor'),
                HdrColor: getColorValue('HdrColor'),
                AudioColor: getColorValue('AudioColor'),
                AudioFlagsColor: getColorValue('AudioFlagsColor'),
                CustomTagColor: getColorValue('CustomTagColor'),
                ResolutionOpacity: Math.min(100, Math.max(0, parseInt(document.querySelector('#ResolutionOpacity').value, 10) || 100)),
                ImdbOpacity: Math.min(100, Math.max(0, parseInt(document.querySelector('#ImdbOpacity').value, 10) || 100)),
                RottenTomatoesOpacity: Math.min(100, Math.max(0, parseInt(document.querySelector('#RottenTomatoesOpacity').value, 10) || 100)),
                HdrOpacity: Math.min(100, Math.max(0, parseInt(document.querySelector('#HdrOpacity').value, 10) || 100)),
                AudioOpacity: Math.min(100, Math.max(0, parseInt(document.querySelector('#AudioOpacity').value, 10) || 100)),
                AudioFlagsOpacity: Math.min(100, Math.max(0, parseInt(document.querySelector('#AudioFlagsOpacity').value, 10) || 100)),
                CustomTagOpacity: Math.min(100, Math.max(0, parseInt(document.querySelector('#CustomTagOpacity').value, 10) || 100)),
                AutoApplyOnLibraryScan: document.querySelector('#AutoApplyOnLibraryScan').checked,
                ShowHDR: document.querySelector('#ShowHDR').checked,
                ShowDolbyAtmos: document.querySelector('#ShowDolbyAtmos').checked,
                ShowDtsX: document.querySelector('#ShowDtsX').checked
            };
        }
        function getColorValue(id) {
            var hexEl = document.querySelector('#' + id + 'Hex');
            var pickerEl = document.querySelector('#' + id);
            var hex = hexEl && hexEl.value ? hexEl.value.trim() : '';
            if (/^#?[0-9A-Fa-f]{6}$/.test(hex)) return hex.charAt(0) === '#' ? hex : '#' + hex;
            if (/^#?[0-9A-Fa-f]{8}$/.test(hex)) return hex.charAt(0) === '#' ? hex : '#' + hex;
            return (pickerEl && pickerEl.value) ? pickerEl.value : '#000000';
        }
        function setColorInputs(id, hex) {
            if (!hex) hex = '#000000';
            hex = hex.trim();
            var pickerEl = document.querySelector('#' + id);
            var hexEl = document.querySelector('#' + id + 'Hex');
            if (hex.length >= 8 && /^#?[0-9A-Fa-f]{8}$/.test(hex.replace('#', ''))) {
                var six = hex.charAt(0) === '#' ? hex.slice(2, 8) : hex.slice(0, 6);
                if (pickerEl) pickerEl.value = '#' + six;
                if (hexEl) hexEl.value = hex.charAt(0) === '#' ? hex : '#' + hex;
            } else if (hex.length >= 6 && /^#?[0-9A-Fa-f]{6}$/.test(hex.replace('#', ''))) {
                var val = hex.charAt(0) === '#' ? hex : '#' + hex;
                if (pickerEl) pickerEl.value = val;
                if (hexEl) hexEl.value = val;
            } else {
                if (pickerEl) pickerEl.value = '#000000';
                if (hexEl) hexEl.value = '#000000';
            }
        }

        function setPreviewStatus(msg, isError) {
            var el = document.querySelector('#PreviewStatus');
            if (!el) return;
            el.textContent = msg || '';
            el.style.color = isError ? '#e74c3c' : '';
        }

        function setPreviewLoading(loading) {
            var spinner = document.querySelector('#PreviewSpinner');
            var btn = document.querySelector('#RefreshPreviewBtn');
            if (spinner) spinner.classList.toggle('isLoading', !!loading);
            if (btn) btn.disabled = !!loading;
        }

        function setPreviewImageBlob(blob) {
            var img = document.querySelector('#PreviewImage');
            var wrap = document.querySelector('#PreviewImageWrap');
            if (!img || !wrap) return;
            if (img.src && img.src.indexOf('blob:') === 0) URL.revokeObjectURL(img.src);
            img.src = blob ? URL.createObjectURL(blob) : '';
            wrap.classList.toggle('has-image', !!blob);
        }

        function loadPreviewImage(useLiveConfig) {
            var img = document.querySelector('#PreviewImage');
            var label = document.querySelector('#PreviewLabel');
            if (!img || !label) return;
            var itemId = PosterTagsConfig.previewItemId;
            if (!itemId) {
                setPreviewStatus('Pick random first or save to load preview.', true);
                return;
            }
            setPreviewLoading(true);
            setPreviewStatus('Loading…');
            var url = ApiClient.getUrl(PosterTagsConfig.previewBase + '/Preview?itemId=' + encodeURIComponent(itemId));
            var opts = { headers: getAuthHeaders(), credentials: 'include' };
            function done(err) {
                setPreviewLoading(false);
                if (err) setPreviewStatus(err, true);
                else setPreviewStatus('');
            }
            if (useLiveConfig) {
                var config = buildConfigFromForm();
                fetch(ApiClient.getUrl(PosterTagsConfig.previewBase + '/Preview'), {
                    method: 'POST',
                    headers: Object.assign({ 'Content-Type': 'application/json' }, getAuthHeaders()),
                    credentials: 'include',
                    body: JSON.stringify({ itemId: itemId, config: config })
                }).then(function (r) {
                    if (!r.ok) throw new Error(r.statusText);
                    return r.blob();
                }).then(function (blob) {
                    setPreviewImageBlob(blob);
                    label.textContent = 'Using: ' + (PosterTagsConfig.previewItemName || itemId);
                    done();
                }).catch(function () {
                    done('Preview failed.');
                });
                return;
            }
            fetch(url, opts).then(function (r) {
                if (!r.ok) throw new Error(r.statusText);
                return r.blob();
            }).then(function (blob) {
                setPreviewImageBlob(blob);
                label.textContent = 'Using: ' + (PosterTagsConfig.previewItemName || itemId);
                done();
            }).catch(function () {
                done('Preview failed.');
            });
        }

        function fetchPreviewItemAndImage() {
            setPreviewLoading(true);
            setPreviewStatus('Loading…');
            setPreviewImageBlob(null);
            document.querySelector('#PreviewLabel').textContent = 'Using: —';
            var url = ApiClient.getUrl(PosterTagsConfig.previewBase + '/PreviewItem');
            fetch(url, { headers: getAuthHeaders(), credentials: 'include' })
                .then(function (r) { return r.ok ? r.json() : Promise.reject(new Error(r.statusText)); })
                .then(function (data) {
                    PosterTagsConfig.previewItemId = data.Id;
                    PosterTagsConfig.previewItemName = data.Name || '';
                    document.querySelector('#PreviewLabel').textContent = 'Using: ' + (data.Name || data.Id) + '…';
                    var config = buildConfigFromForm();
                    return fetch(ApiClient.getUrl(PosterTagsConfig.previewBase + '/Preview'), {
                        method: 'POST',
                        headers: Object.assign({ 'Content-Type': 'application/json' }, getAuthHeaders()),
                        credentials: 'include',
                        body: JSON.stringify({ itemId: data.Id, config: config })
                    });
                })
                .then(function (r) {
                    if (!r.ok) throw new Error(r.statusText);
                    return r.blob();
                })
                .then(function (blob) {
                    setPreviewImageBlob(blob);
                    setPreviewStatus('');
                    setPreviewLoading(false);
                })
                .catch(function () {
                    setPreviewStatus('No items with posters in selected libraries.', true);
                    setPreviewLoading(false);
                });
        }

        var pageEl = document.querySelector('#PosterTagsConfigPage');
        if (pageEl && typeof ApiClient !== 'undefined' && typeof Dashboard !== 'undefined') {
            pageEl.addEventListener('pageshow', function () {
                Dashboard.showLoadingMsg();
                ApiClient.getPluginConfiguration(PosterTagsConfig.pluginUniqueId).then(function (config) {
                if (config) {
                    document.querySelector('#Show4K').checked = config.Show4K !== false;
                    document.querySelector('#ShowHD').checked = config.ShowHD !== false;
                    document.querySelector('#ShowQuality').checked = config.ShowQuality !== false;
                    document.querySelector('#ShowAudioLanguageFlags').checked = config.ShowAudioLanguageFlags !== false;
                    document.querySelector('#SkipItemsWithNoAudioLanguage').checked = config.SkipItemsWithNoAudioLanguage !== false;
                    document.querySelector('#ShowImdbRating').checked = config.ShowImdbRating !== false;
                    document.querySelector('#ShowRottenTomatoes').checked = config.ShowRottenTomatoes !== false;
                    document.querySelector('#UseExternalRatings').checked = config.UseExternalRatings === true;
                    document.querySelector('#MdbListApiKey').value = config.MdbListApiKey || '';
                    document.querySelector('#TmdbApiKey').value = config.TmdbApiKey || '';
                    document.querySelector('#CustomTagEnabled').checked = config.CustomTagEnabled === true;
                    document.querySelector('#CustomTagText').value = config.CustomTagText || '';
                    document.querySelector('#CustomTagPosition').value = config.CustomTagPosition || 'TopLeft';
                    document.querySelector('#TagCurvature').value = Math.min(100, Math.max(0, parseInt(config.TagCurvature, 10) || 0));
                    document.querySelector('#TagSize').value = Math.min(100, Math.max(12, parseInt(config.TagSize, 10) || 18));
                    var rf = config.ResolutionFormat !== undefined ? Math.min(2, Math.max(0, parseInt(config.ResolutionFormat, 10))) : (config.UseLetterResolution !== false ? 0 : 1);
                    document.querySelector('#ResolutionFormat').value = String(rf);
                    document.querySelector('#ResolutionPosition').value = config.ResolutionPosition || 'BottomLeft';
                    document.querySelector('#ImdbPosition').value = config.ImdbPosition || 'BottomLeft';
                    document.querySelector('#RottenTomatoesPosition').value = config.RottenTomatoesPosition || 'BottomLeft';
                    document.querySelector('#HdrPosition').value = config.HdrPosition || 'BottomLeft';
                    document.querySelector('#AudioPosition').value = config.AudioPosition || 'BottomLeft';
                    document.querySelector('#AudioFlagsPosition').value = config.AudioFlagsPosition || 'BottomLeft';
                    setColorInputs('ResolutionColor', config.ResolutionColor);
                    setColorInputs('ImdbColor', config.ImdbColor);
                    setColorInputs('RottenTomatoesColor', config.RottenTomatoesColor);
                    setColorInputs('HdrColor', config.HdrColor);
                    setColorInputs('AudioColor', config.AudioColor);
                    setColorInputs('AudioFlagsColor', config.AudioFlagsColor);
                    setColorInputs('CustomTagColor', config.CustomTagColor);
                    var opIds = ['ResolutionOpacity', 'ImdbOpacity', 'RottenTomatoesOpacity', 'HdrOpacity', 'AudioOpacity', 'AudioFlagsOpacity', 'CustomTagOpacity'];
                    var opVals = [config.ResolutionOpacity, config.ImdbOpacity, config.RottenTomatoesOpacity, config.HdrOpacity, config.AudioOpacity, config.AudioFlagsOpacity, config.CustomTagOpacity];
                    opIds.forEach(function (id, i) { var el = document.querySelector('#' + id); if (el) { var v = Math.min(100, Math.max(0, parseInt(opVals[i], 10) || 100)); el.value = v; var lab = document.querySelector('#' + id + 'Val'); if (lab) lab.textContent = v + '%'; } });
                    document.querySelector('#AutoApplyOnLibraryScan').checked = config.AutoApplyOnLibraryScan !== false;
                    document.querySelector('#ShowHDR').checked = config.ShowHDR !== false;
                    document.querySelector('#ShowDolbyAtmos').checked = config.ShowDolbyAtmos !== false;
                    document.querySelector('#ShowDtsX').checked = config.ShowDtsX !== false;
                    updateCurvatureLabel(parseInt(document.querySelector('#TagCurvature').value, 10));
                    updateTagSizeLabel(parseInt(document.querySelector('#TagSize').value, 10));
                    loadLibraries(config.SelectedLibraryIds || []);
                    fetchPreviewItemAndImage();
                }
                Dashboard.hideLoadingMsg();
            }).catch(function () {
                Dashboard.hideLoadingMsg();
            });
            });
        }
        var refreshBtn = document.querySelector('#RefreshPreviewBtn');
        if (refreshBtn && typeof ApiClient !== 'undefined') {
            refreshBtn.addEventListener('click', function () {
                fetchPreviewItemAndImage();
            });
        }

        function scheduleLivePreview() {
            if (PosterTagsConfig.previewDebounce) clearTimeout(PosterTagsConfig.previewDebounce);
            PosterTagsConfig.previewDebounce = setTimeout(function () {
                PosterTagsConfig.previewDebounce = null;
                if (PosterTagsConfig.previewItemId) loadPreviewImage(true);
            }, 1200);
        }
        ['Show4K', 'ShowHD', 'ShowQuality', 'ShowAudioLanguageFlags', 'SkipItemsWithNoAudioLanguage', 'ShowImdbRating', 'ShowRottenTomatoes', 'UseExternalRatings', 'CustomTagEnabled', 'CustomTagText', 'CustomTagPosition', 'TagCurvature', 'TagSize', 'ResolutionFormat', 'ResolutionPosition', 'ImdbPosition', 'RottenTomatoesPosition', 'HdrPosition', 'AudioPosition', 'AudioFlagsPosition', 'ShowHDR', 'ShowDolbyAtmos', 'ShowDtsX', 'ResolutionColor', 'ResolutionColorHex', 'ImdbColor', 'ImdbColorHex', 'RottenTomatoesColor', 'RottenTomatoesColorHex', 'HdrColor', 'HdrColorHex', 'AudioColor', 'AudioColorHex', 'AudioFlagsColor', 'AudioFlagsColorHex', 'CustomTagColor', 'CustomTagColorHex', 'ResolutionOpacity', 'ImdbOpacity', 'RottenTomatoesOpacity', 'HdrOpacity', 'AudioOpacity', 'AudioFlagsOpacity', 'CustomTagOpacity'].forEach(function (id) {
            var el = document.querySelector('#' + id);
            if (el) {
                el.addEventListener('change', scheduleLivePreview);
                if (id === 'CustomTagText') el.addEventListener('input', scheduleLivePreview);
                if (id.endsWith('Color') && !id.endsWith('ColorHex')) {
                    el.addEventListener('input', function () { var h = document.querySelector('#' + id + 'Hex'); if (h) h.value = el.value; scheduleLivePreview(); });
                }
                if (id.endsWith('ColorHex')) {
                    el.addEventListener('input', function () {
                        var hex = el.value.trim();
                        if (/^#?[0-9A-Fa-f]{6}$/.test(hex)) { var picker = document.querySelector('#' + id.replace('Hex', '')); if (picker) picker.value = hex.charAt(0) === '#' ? hex : '#' + hex; }
                        scheduleLivePreview();
                    });
                }
            }
            if (id === 'TagCurvature') {
                var curv = document.querySelector('#TagCurvature');
                if (curv) curv.addEventListener('input', scheduleLivePreview);
            }
            if (id === 'TagSize') {
                var ts = document.querySelector('#TagSize');
                if (ts) ts.addEventListener('input', scheduleLivePreview);
            }
            if (id.endsWith('Opacity')) {
                var opEl = document.querySelector('#' + id);
                if (opEl) {
                    opEl.addEventListener('input', function () { var v = document.querySelector('#' + id + 'Val'); if (v) v.textContent = this.value + '%'; scheduleLivePreview(); });
                }
            }
        });

        function updateTagSizeLabel(val) {
            var el = document.querySelector('#TagSizeLabel');
            if (!el) return;
            el.textContent = (val || 18) + 'px';
        }
        document.querySelector('#TagSize').addEventListener('input', function () {
            updateTagSizeLabel(parseInt(this.value, 10));
        });

        function updateCurvatureLabel(val) {
            var el = document.querySelector('#TagCurvatureLabel');
            if (!el) return;
            if (val <= 0) el.textContent = '0 — Rectangle';
            else if (val >= 100) el.textContent = '100 — Pill';
            else el.textContent = val + ' — Rounded';
        }
        document.querySelector('#TagCurvature').addEventListener('input', function () {
            updateCurvatureLabel(parseInt(this.value, 10));
        });

        function getLibrariesUrl() {
            var base = (window.location.origin || '').replace(/\/$/, '');
            return base + '/Plugins/PosterTags/Libraries';
        }
        function loadLibraries(selectedIds) {
            var container = document.querySelector('#LibraryCardsContainer');
            if (!container) return;
            container.innerHTML = '';
            var url = getLibrariesUrl();
            var opts = { credentials: 'include', headers: getAuthHeaders() };
            fetch(url, opts)
                .then(function (r) { return r.ok ? r.json() : Promise.reject(new Error(r.statusText)); })
                .then(function (libraries) {
                    (libraries || []).forEach(function (lib, index) {
                        var id = lib.Id || '';
                        var name = lib.Name || lib.Id || id || 'Library';
                        var label = document.createElement('label');
                        label.className = 'library-card';
                        var cb = document.createElement('input');
                        cb.type = 'checkbox';
                        cb.name = 'LibraryIds';
                        cb.value = id;
                        cb.id = 'postertags-lib-' + index;
                        cb.checked = selectedIds.indexOf(id) !== -1;
                        label.htmlFor = cb.id;
                        var span = document.createElement('span');
                        span.className = 'library-name';
                        span.textContent = name;
                        label.appendChild(cb);
                        label.appendChild(span);
                        container.appendChild(label);
                    });
                })
                .catch(function () {});
        }
        (function ensureLibrariesLoad() {
            function run() { loadLibraries([]); }
            if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', run);
            else run();
        })();

        var formEl = document.querySelector('#PosterTagsConfigForm');
        if (formEl && typeof ApiClient !== 'undefined' && typeof Dashboard !== 'undefined') {
            formEl.addEventListener('submit', function (e) {
                e.preventDefault();
                Dashboard.showLoadingMsg();
            var selectedIds = [];
            document.querySelectorAll('input[name="LibraryIds"]:checked').forEach(function (cb) { selectedIds.push(cb.value); });
            ApiClient.getPluginConfiguration(PosterTagsConfig.pluginUniqueId).then(function (config) {
                if (!config) config = {};
                config.Show4K = document.querySelector('#Show4K').checked;
                config.ShowHD = document.querySelector('#ShowHD').checked;
                config.ShowQuality = document.querySelector('#ShowQuality').checked;
                config.ShowAudioLanguageFlags = document.querySelector('#ShowAudioLanguageFlags').checked;
                config.SkipItemsWithNoAudioLanguage = document.querySelector('#SkipItemsWithNoAudioLanguage').checked;
                config.ShowImdbRating = document.querySelector('#ShowImdbRating').checked;
                config.ShowRottenTomatoes = document.querySelector('#ShowRottenTomatoes').checked;
                config.UseExternalRatings = document.querySelector('#UseExternalRatings').checked;
                config.MdbListApiKey = (document.querySelector('#MdbListApiKey').value || '').trim();
                config.TmdbApiKey = (document.querySelector('#TmdbApiKey').value || '').trim();
                config.CustomTagEnabled = document.querySelector('#CustomTagEnabled').checked;
                config.CustomTagText = (document.querySelector('#CustomTagText').value || '').trim();
                config.CustomTagPosition = document.querySelector('#CustomTagPosition').value || 'TopLeft';
                config.TagCurvature = Math.min(100, Math.max(0, parseInt(document.querySelector('#TagCurvature').value, 10) || 0));
                config.TagSize = Math.min(100, Math.max(12, parseInt(document.querySelector('#TagSize').value, 10) || 18));
                config.ResolutionFormat = Math.min(2, Math.max(0, parseInt(document.querySelector('#ResolutionFormat').value, 10) || 0));
                config.ResolutionPosition = document.querySelector('#ResolutionPosition').value || 'BottomLeft';
                config.ImdbPosition = document.querySelector('#ImdbPosition').value || 'BottomLeft';
                config.RottenTomatoesPosition = document.querySelector('#RottenTomatoesPosition').value || 'BottomLeft';
                config.HdrPosition = document.querySelector('#HdrPosition').value || 'BottomLeft';
                config.AudioPosition = document.querySelector('#AudioPosition').value || 'BottomLeft';
                config.AudioFlagsPosition = document.querySelector('#AudioFlagsPosition').value || 'BottomLeft';
                config.ResolutionColor = getColorValue('ResolutionColor');
                config.ImdbColor = getColorValue('ImdbColor');
                config.RottenTomatoesColor = getColorValue('RottenTomatoesColor');
                config.HdrColor = getColorValue('HdrColor');
                config.AudioColor = getColorValue('AudioColor');
                config.AudioFlagsColor = getColorValue('AudioFlagsColor');
                config.CustomTagColor = getColorValue('CustomTagColor');
                config.ResolutionOpacity = Math.min(100, Math.max(0, parseInt(document.querySelector('#ResolutionOpacity').value, 10) || 100));
                config.ImdbOpacity = Math.min(100, Math.max(0, parseInt(document.querySelector('#ImdbOpacity').value, 10) || 100));
                config.RottenTomatoesOpacity = Math.min(100, Math.max(0, parseInt(document.querySelector('#RottenTomatoesOpacity').value, 10) || 100));
                config.HdrOpacity = Math.min(100, Math.max(0, parseInt(document.querySelector('#HdrOpacity').value, 10) || 100));
                config.AudioOpacity = Math.min(100, Math.max(0, parseInt(document.querySelector('#AudioOpacity').value, 10) || 100));
                config.AudioFlagsOpacity = Math.min(100, Math.max(0, parseInt(document.querySelector('#AudioFlagsOpacity').value, 10) || 100));
                config.CustomTagOpacity = Math.min(100, Math.max(0, parseInt(document.querySelector('#CustomTagOpacity').value, 10) || 100));
                config.AutoApplyOnLibraryScan = document.querySelector('#AutoApplyOnLibraryScan').checked;
                config.ShowHDR = document.querySelector('#ShowHDR').checked;
                config.ShowDolbyAtmos = document.querySelector('#ShowDolbyAtmos').checked;
                config.ShowDtsX = document.querySelector('#ShowDtsX').checked;
                config.SelectedLibraryIds = selectedIds;
                ApiClient.updatePluginConfiguration(PosterTagsConfig.pluginUniqueId, config).then(function (result) {
                    Dashboard.processPluginConfigurationUpdateResult(result);
                }).catch(function () {
                    Dashboard.hideLoadingMsg();
                });
            }).catch(function () {
                Dashboard.hideLoadingMsg();
            });
                return false;
            });
        }
    </script>
</div>
